data <- readRDS("flu_data_with_backfill.rds")

fully_observed_data <- matrix(NA,ncol=3)

for (region in unique(data$region)){
  for (week in unique(data$epiweek)){
    fully_observed_wili <- data[data$region==region & data$epiweek == week & data$lag == max(data[data$region==region & data$epiweek == week,]$lag),]$wili
    if (length(fully_observed_wili) >0){
      fully_observed_data <- rbind(fully_observed_data,c(region,week, fully_observed_wili)) 
    }
  }
}
colnames(fully_observed_data) <- c("obs","region","week","wili")
write.csv(fully_observed_data,"fully_observed_data")
